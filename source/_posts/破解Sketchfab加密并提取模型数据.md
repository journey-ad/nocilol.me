---
title: ç ´è§£SketchfabåŠ å¯†å¹¶æå–æ¨¡å‹æ•°æ®
date: 2018-11-20 15:52:00
categories: lab
tags: [3D,ç ´è§£,æ¨¡å‹]
urlname: ripping-sketchfab-models
---
![é­”æ³•å°‘å¥³æ™ºä¹ƒ](https://img.imjad.cn/images/2018/11/20/record.gif)

{% cplayer %}
- 33955999
{% endcplayer %}

## å‰è¨€
>éœ€è¦è¯´æ˜çš„æ˜¯ï¼ŒæŠ˜è…¾ä»…é™ç”¨äºå­¦ä¹ ç”¨é€”ï¼Œå¯é€šè¿‡æ­£è§„é€”å¾„è´­ä¹°çš„æ¨¡å‹è¯·å‹¿éæ³•æå–ï¼Œè¯·å‹¿å¯¹æ¨¡å‹åŠè´´å›¾ç­‰æ•°æ®è¿›è¡Œä¿®æ”¹ã€äºŒæ¬¡åˆ†å‘ã€å•†ç”¨ç­‰è¿åSketchfabç‰ˆæƒè§„å®šåŠè‘—ä½œæƒç›¸å…³æ³•å¾‹æ³•è§„çš„è¡Œä¸ºã€‚ä½¿ç”¨æœ¬æ–‡æåˆ°çš„æ–¹æ³•æå–æ¨¡å‹äº§ç”Ÿçš„ä¸€åˆ‡åæœç”±æ“ä½œäººæ‰¿æ‹…ï¼Œä¸æœ¬ç½‘ç«™åŠæœ¬äººæ— å…³



æœ€è¿‘åœ¨Sketchfabçœ‹åˆ°äº†ä¸€ä¸ª[æ™ºä¹ƒçš„æ¨¡å‹](https://sketchfab.com/models/9120703a4aee4c2cb0313a9ca3e1e1a3)ï¼Œé¡¿æ—¶æ„Ÿè§‰æƒ³è¦æ‹¥æœ‰ï¼Œä½†æ¨¡å‹ä½œè€…å¹¶æ²¡æœ‰å¼€æ”¾ä¸‹è½½å’Œè´­ä¹°ï¼Œè¿«äºå®åœ¨æ˜¯å¿ƒç—’éš¾è€ï¼Œä¾¿åœ¨ç½‘ä¸Šå¯»æ‰¾ç ´è§£SketchfabåŠ å¯†çš„æ–¹æ³•

é¦–å…ˆåœ¨æŸå®ä¸Šæœç´¢ï¼Œå‘ç°æœ‰å‡ å®¶åº—é“ºæä¾›äº†æ”¶è´¹ä¸‹è½½æœåŠ¡ï¼Œè™½ç„¶æ²¡æœ‰æ˜è¯´ï¼Œä½†çœ‹æè¿°ä¿¡æ¯å¯ä»¥å®ç°â€œä»»æ„ä¸‹è½½â€ï¼Œå¿ƒä¸­åº•æ°”åˆè¶³äº†ä¸¤åˆ†~~æŸå®ä¸‹è½½æœåŠ¡å‡ä»·20 RMBï¼Œå¸Œæœ›ä¸è¦å› ä¸ºç ¸äº†åˆ«äººé¥­ç¢—è€Œè¢«è¿½æ€ğŸŒ~~

ç½‘ç»œä¸Šçš„èµ„æ–™ä¸å¤šï¼Œé›¶æ˜Ÿå‡ ä¸ªæåˆ°çš„ä¿¡æ¯æŒ‡å‘äº†Ninja Ripperã€‚è¿™ä¸€å·¥å…·åŸç†æ˜¯åŠ«æŒç³»ç»ŸDirectXæ¥å£ï¼Œç›´æ¥ä»å†…å­˜ä¸­æ‹¿åˆ°æ¸²æŸ“æ•°æ®ï¼Œç†è®ºä¸Šå¯ä»¥æ”¯æŒä»»æ„D3Dåº”ç”¨ï¼Œå¹¶ä¸”æ— è§†ä»»ä½•åŠ å¯†ï¼Œæ¯•ç«Ÿä¸ç®¡æ€ä¹ˆåŠ å¯†ï¼Œæœ€åç³»ç»Ÿå–‚ç»™æ˜¾å¡çš„éƒ½æ˜¯æ ‡å‡†çš„æ•°æ®ã€‚å¯æƒœçš„æ˜¯Sketchfabåœ¨å‡ ä¸ªæœˆå‰å·²ç»å‡çº§äº†ç³»ç»Ÿï¼Œæå–å‡ºæ¥çš„éƒ½æ˜¯ä¸€äº›æ®‹ç‰‡ï¼Œæ²¡æœ‰ä½¿ç”¨ä»·å€¼

æŠ±ç€ä¸æ­»å¿ƒçš„æƒ³æ³•ç»§ç»­æœç´¢ï¼Œç»ˆäºåœ¨ä¸€ä¸ªæ¯›å­è®ºå›ä¸Šæ‰¾åˆ°äº†å¸Œæœ›ï¼šä¸€ä¸ªè§£å¯†è„šæœ¬ã€‚è¿™ä¸ªå·¥å…·çš„åŸç†å°±å¾ˆç›´æ¥äº†ï¼Œå› ä¸ºSketchfabä½¿ç”¨äº†WebGLæ¥æ˜¾ç¤ºæ¨¡å‹ï¼Œé‚£ä¹ˆç†è®ºä¸Šå°±ä¸€å®šèƒ½å¤Ÿç ´è§£ï¼Œæ¯•ç«ŸåŠ è§£å¯†ç®—æ³•éƒ½åœ¨å‰ç«¯ã€‚è¿™ä¸ªè„šæœ¬çš„ä½œè€…é€†å‘äº†å‡ºè§£å¯†ç®—æ³•ï¼Œå¹¶ç”¨Pythonå®ç°å‡ºè§£å¯†å·¥å…·ï¼Œåšæˆäº†Blenderçš„æ’ä»¶ï¼Œè™½ç„¶éƒ½æ˜¯å¾ˆå¤è€çš„ç‰ˆæœ¬ï¼Œä½†è¦ä»€ä¹ˆè‡ªè¡Œè½¦ï¼Œèƒ½ç”¨å°±è¡Œ

é‚£ä¹ˆå°±åˆ©ç”¨ç©ºä½™æ—¶é—´ï¼Œç®€å•è®°ä¸‹æŠ˜è…¾è¿‡ç¨‹


## æå–

### æ‰€éœ€å·¥å…·
- Python 2.6.6
- Blender 2.49
- **[Blender249[osgjs].zip](https://cdn.imjad.cn/usr/uploads/Blender249[osgjs].zip)** è§£å¯†è„šæœ¬


### å·¥å…·å‡†å¤‡
1. å®‰è£…Pythonç¯å¢ƒ (ä»¥ä¸‹æ–¹æ³•äºŒé€‰ä¸€ï¼Œæ¨èaæ–¹æ³•ï¼Œå¯ç§»åŠ¨ä½¿ç”¨ä¸”ä¸å½±å“å…¶ä»–Pythonç‰ˆæœ¬)
   - a.ä¸‹è½½Python 2.6.6æºç åŒ…ï¼Œå°†å…¶ä¸­çš„**Lib**ç›®å½•ä¸­çš„å†…å®¹å‹ç¼©ä¸º**python26.zip**å¹¶æ”¾ç½®äºBlenderå®‰è£…ç›®å½•
   - b.æ‰§è¡Œå®‰è£…ç¨‹åºå¹¶æ·»åŠ ç¯å¢ƒå˜é‡`PythonPath`ï¼Œå€¼ä¸º`C:\Python26;C:\Python26\DLLs;C:\Python26\Lib;C:\Python26\Lib\lib-tk`ï¼ˆå‡è®¾å®‰è£…ç›®å½•ä¸º`C:\Python26`ï¼‰
2. å®‰è£…Blender 2.49
3. å°†**Blender249[osgjs].zip**ä¸­çš„**newGameLib**ç›®å½•è§£å‹è‡³Blenderå®‰è£…ç›®å½•ä¸­çš„`.blender\scripts`ç›®å½•ä¸‹
4. **Blender249.blend**å•ç‹¬æ”¾ç½®


### ä¸‹è½½æ¨¡å‹æ•°æ®
1. æ‰“å¼€æµè§ˆå™¨å¹¶æ‰“å¼€Dev Tools
2. æ‰“å¼€æ‰€éœ€æ¨¡å‹çš„Sketchfabé¡µé¢ï¼Œç¡®ä¿æ¨¡å‹å·²ç»å®Œå…¨åŠ è½½
3. åœ¨Networké€‰é¡¹å¡ä¸­æ‰¾åˆ°å¦‚ä¸‹ä¸¤ä¸ªæ–‡ä»¶å¹¶ä¸‹è½½ä¸‹æ¥æ”¾åˆ°ä¸€èµ·
   - **file.osgjs.gz**
   - **model_file.bin.gz**
4. å…¶ä¸­**file.osgjs.gz**æ˜¯ä¸€ä¸ªJSONæ–‡ä»¶ï¼Œå°†å…¶é‡å‘½åä¸º**file.osgjs**
5. è´´å›¾èµ„æºåœ¨`media.sketchfab.com`ä¸‹ï¼Œæœ‰ä¸åŒåˆ†è¾¨ç‡ä¹‹åˆ†ï¼Œæ³¨æ„é‰´åˆ«
6. ä¹Ÿå¯ä»¥å¿½ç•¥ä»¥ä¸Šæ­¥éª¤ï¼Œç›´æ¥ä»ç½‘é¡µåŒ…å«çš„æ•°æ®ä¸­æå–ï¼Œå…·ä½“å¯å‚è€ƒä¸‹åˆ—ä»£ç ï¼š


#### æ¨¡å‹æ•°æ®ä¸‹è½½è„šæœ¬
ä¸ºäº†å¿«é€Ÿä¸‹è½½æ¨¡å‹æ•°æ®ï¼Œæˆ‘å†™äº†ä¸€ä¸ªç®€å•çš„ä¸‹è½½è„šæœ¬ï¼š
```python
import os
import re
import json
import requests
from urllib.parse import urlparse
from html import unescape
from bs4 import BeautifulSoup

SCRIPT_VERSION = '1.0'

HEADERS = {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.25 Safari/537.36',
    'accept-encoding': 'gzip, deflate, br',
    'accept-language': 'zh-CN,zh-TW;q=0.8,zh;q=0.6,en;q=0.4,ja;q=0.2',
    'cache-control': 'max-age=0'
}

def main():
    url = input('input url:')
    parse(url)

def parse(url):
    try:
        print('Parsing...')
        page = requests.get(url, headers=HEADERS, timeout=10).text
        soup = BeautifulSoup(page, 'html.parser')

        modelId = urlparse(url).path.split('/')[2].split('-')[-1]
        data = unescape(soup.find(id='js-dom-data-prefetched-data').string)
        data = json.loads(data)
        name = validateTitle(data['/i/models/'+modelId]['name'])
        thumbnailData = data['/i/models/'+modelId]['thumbnails']['images']
        thumbnail = getBiggestImage(thumbnailData)
        osgjsUrl = data['/i/models/'+modelId]['files'][0]['osgjsUrl']
        modelFile = osgjsUrl.replace('file.osgjs.gz', 'model_file.bin.gz')
        texturesData = data['/i/models/'+modelId+'/textures?optimized=1']['results']
        textures = []

        print('Model Id:', modelId)
        print('Name:', name)
        print('Thumbnail URL:',thumbnail)
        print('osgjs URL:', osgjsUrl)
        print('Model File:', modelFile)
        print('Textures:', len(texturesData))

        download(thumbnail, os.path.join(name, 'thumbnail.jpg'))
        download(osgjsUrl, os.path.join(name, 'file.osgjs'))
        download(modelFile, os.path.join(name, 'model_file.bin.gz'))

        for texture in texturesData:
            textureUrl = getBiggestImage(texture['images'])
            download(textureUrl, os.path.join(name, 'texture', validateTitle(texture['name'])))

    except AttributeError:
        raise
        return False

def getBiggestImage(images):
    size = 0
    for img in images:
        if img['size'] != None and img['size'] > size:
            size = img['size']
            imgUrl = img['url']
    return imgUrl

def validateTitle(title):
    pattern = r'[\\/:*?"<>|\r\n]+'
    newTitle = re.sub(pattern, "_", title)
    return newTitle

def download(url, filename):
    print('Downloading:', filename)
    try:
        os.makedirs(os.path.dirname(filename), exist_ok=True)
        if os.path.exists(filename):
            if os.path.getsize(filename) > 0:
                print('file exists.')
            else:
                with open(filename, 'wb') as file:
                    file.write(requests.get(url, headers=HEADERS, timeout=30).content)
        else:
            with open(filename, 'wb') as file:
                file.write(requests.get(url, headers=HEADERS, timeout=30).content)
    except Exception:
        pass

if __name__ == '__main__':
    main()
```


### æå–è¿‡ç¨‹
1. å¯åŠ¨Blenderï¼Œå°†éšä¹‹å¯åŠ¨ä¸€ä¸ªCMDçª—å£ï¼Œå¯è§‚å¯Ÿæœ‰æ— æŠ¥é”™
2. ç‚¹å‡»**File** - **Open**ï¼Œæ‰“å¼€`Blender249.blend`ï¼Œç„¶åæŒ‰<kbd>Ctrl</kbd> + <kbd>U</kbd>ï¼Œè¿™æ ·ä»¥åå°±ä¸ç”¨é‡å¤æ­¤æ­¥äº†
3. å³é”®ç‚¹å‡»çª—å£å·¦ä¾§çš„Pythonä»£ç åŒºåŸŸï¼Œç„¶åç‚¹å‡»**Execute Script**æˆ–æŒ‰<kbd>Alt</kbd> + <kbd>P</kbd>
4. åœ¨å‡ºç°çš„æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ä¸­å¯¼å…¥æ­¤å‰ä¸‹è½½çš„`file.osgjs`
5. å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒCMDçª—å£å°†åˆ·è¿‡å¤§é‡è§£å¯†æ“ä½œç›¸å…³ä¿¡æ¯ï¼Œå¹¶åœ¨è§†å›¾ä¸­æ˜¾ç¤ºè§£å¯†åçš„æ¨¡å‹
6. ç‚¹å‡»**File** - **Export**ï¼Œå°†è§£å¯†åçš„æ¨¡å‹æ–‡ä»¶å¯¼å‡ºä¸ºå…¶ä»–æ ¼å¼
7. è´´å›¾å’ŒåŠ¨ç”»æ•°æ®ä¸ä¼šè¢«ä¿å­˜ï¼Œå¯¼å‡ºçš„æ¨¡å‹å¯ä»¥åœ¨ä»»ä½•3Dåˆ¶ä½œè½¯ä»¶ä¸­è¿›è¡Œç¼–è¾‘

![Blenderé‡Œçš„æ™ºä¹ƒ](https://img.imjad.cn/images/2018/11/20/sp181117_203901.png)


#### å¯èƒ½é‡åˆ°çš„é”™è¯¯

##### æç¤º`IndexError: list index out of range`ï¼Œå®Œæ•´æŠ¥é”™ç±»ä¼¼å¦‚ä¸‹ï¼š
```shell
Traceback (most recent call last):
  File "starter.py", line 1767, in openFile
  File "starter.py", line 1760, in Parser
  File "starter.py", line 1723, in osgParser
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 670, in draw
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 588, in addFaces
  File "C:\blender-2.49-win64\.blender\scripts\newGameLib\myLibraries\meshLib.py", line 822, in indicesToTriangleStrips
IndexError: list index out of range
```

è§£å†³æ–¹æ³•ï¼šblenderå·¦ä¾§çš„Pythonä»£ç æ³¨é‡Šæ‰`330-351`è¡Œ


## çœ‹å›¾
![æ²¡ç©¿è¡£æœçš„æ™ºä¹ƒ](https://img.imjad.cn/images/2018/11/20/sp181117_214136.png)

![åŠ ä¸Šè´´å›¾çš„æ™ºä¹ƒ](https://img.imjad.cn/images/2018/11/20/sp181117_214107.png)